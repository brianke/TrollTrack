<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TrollTrack.MVVM.Views.LuresView"
             xmlns:vm="clr-namespace:TrollTrack.MVVM.ViewModels"
             xmlns:model="clr-namespace:TrollTrack.MVVM.Models"
             x:DataType="vm:LuresViewModel"
             Title="{Binding Title}">
    <Grid>
        <CollectionView ItemsSource="{Binding Lures}">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="model:LureData">
                    <Border Padding="10" Margin="10">
                        <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*">
                            <Image Grid.RowSpan="2" Source="{Binding PrimaryImagePath}" WidthRequest="100" HeightRequest="100">
                                <Image.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:LuresViewModel}}, Path=OpenImageCommand}"
                                                              CommandParameter="{Binding PrimaryImagePath}" />
                                </Image.GestureRecognizers>
                            </Image>
                            <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                <Label Text="{Binding Manufacturer}" FontSize="Large" />
                                <Label Text="{Binding Color}" FontSize="Medium" />
                            </VerticalStackLayout>
                            <Grid Grid.Row="1" Grid.Column="1" ColumnDefinitions="*,*,*" Margin="0,10,0,0">
                                <VerticalStackLayout>
                                    <Label Text="Buoyancy" FontSize="Small" />
                                    <Label Text="{Binding Buoyancy}" FontSize="Small" />
                                </VerticalStackLayout>
                                <VerticalStackLayout Grid.Column="1">
                                    <Label Text="Length" FontSize="Small" />
                                    <Label Text="{Binding Length}" FontSize="Small" />
                                </VerticalStackLayout>
                                <VerticalStackLayout Grid.Column="2">
                                    <Label Text="Weight" FontSize="Small" />
                                    <Label Text="{Binding Weight}" FontSize="Small" />
                                </VerticalStackLayout>
                            </Grid>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    
        <!-- Image Modal Overlay -->
        <Grid IsVisible="{Binding IsImageModalVisible}"
                  BackgroundColor="#80000000">

            <!-- Semi-transparent background that closes modal when tapped -->
            <BoxView Color="Transparent">
                <BoxView.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding CloseImageCommand}" />
                </BoxView.GestureRecognizers>
            </BoxView>

            <!-- Modal content -->
            <Border BackgroundColor="White" 
                        Margin="20"
                        VerticalOptions="Center">
                <Grid>
                    <!-- Full-size image -->
                    <Image Source="{Binding SelectedImagePath}"
                               Aspect="AspectFit"
                               VerticalOptions="FillAndExpand"
                               HorizontalOptions="FillAndExpand" />

                    <!-- Close button -->
                    <Button Text="âœ•"
                                BackgroundColor="Black"
                                TextColor="White"
                                WidthRequest="40"
                                HeightRequest="40"
                                CornerRadius="20"
                                FontSize="18"
                                HorizontalOptions="End"
                                VerticalOptions="Start"
                                Margin="10"
                                Command="{Binding CloseImageCommand}" />
                </Grid>
            </Border>
        </Grid>
    </Grid>
</ContentPage>